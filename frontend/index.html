<!DOCTYPE html>
<html lang="tr">
<head>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"> </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Güncel Haberler</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body class="light-theme">
  <header>
    <h1>Güncel Haberler</h1>
    <button id="theme-toggle">☀️</button>
  </header>
  <div class="haberler-container"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const toggleBtn = document.getElementById('theme-toggle');
      toggleBtn.addEventListener('click', function() {
        document.body.classList.toggle('dark-theme');
        document.body.classList.toggle('light-theme');
        toggleBtn.innerHTML = document.body.classList.contains('dark-theme') ? '🌙' : '☀️';
      });
  
      function formatDate(timestamp, time) {
        if (!timestamp) return "Bilinmeyen tarih";
        let date = new Date(timestamp);
        if (time === null) {
          return date.toLocaleDateString("tr-TR", { year: "numeric", month: "long", day: "numeric" });
        } else {
          return date.toLocaleString("tr-TR", { dateStyle: "long", timeStyle: "short" });
        }
      }
  
      const evtSource = new EventSource("/stream");
      evtSource.onmessage = function(event) {
        const newsData = JSON.parse(event.data);
        const container = document.querySelector('.haberler-container');
        container.innerHTML = "";

        newsData.forEach(haber => {
          const card = document.createElement('div');
          card.classList.add('kart');
          const resim = haber.resim ? `<img src="${haber.resim}" alt="Haber Resmi">` : '';
          const baslik = haber.baslik ? `<h2>${haber.baslik}</h2>` : '<h2>Başlık bulunamadı</h2>';
          const aciklama = haber.aciklama ? `<p>${haber.aciklama}</p>` : '';
          const formattedDate = formatDate(haber.timestamp, haber.saat);
          const source = haber.source ? `<p><strong>Kaynak:</strong> ${haber.source}</p>` : '';

          card.innerHTML = 
            `${resim}
            ${baslik}
            ${aciklama}
            <a href="${haber.link}" target="_blank">Devamını oku</a>
            <p class="timestamp">Eklenme zamanı: ${formattedDate}</p>
            ${source}`;

          container.appendChild(card);
        });
      };
    });
  </script>
</body>
</html>
